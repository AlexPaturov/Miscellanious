# IncomingControllerV — GET (Read) матрица тестов

## Общие правила для GET
- Авторизация включена:
   - без токена → `401 Unauthorized` (или `403 Forbidden`, если так настроено)
- `500` не покрываем как обязательный исход (это авария).
- `NOT FOUND` по домену оформлен как `200 OK` с пустым списком.

> Важно: для GET будем формировать данные через POST (Arrange), чтобы тесты не зависели от состояния БД.

---

## 1) GET /api/v1/incoming/wagons/by-date
### Операция
Получить список записей по `dt` и `vesy`.

### Исходы
| ID | Сценарий | Предусловия | HTTP | Ожидаемое тело (минимум)                    | Важность |
|---|---|---|---:|---------------------------------------------|---|
| INC-RD-01 | Есть данные по dt+vesy | Создать запись(и) через POST на эту dt+vesy | 200 | список > 0` | must |
| INC-RD-02 | Нет данных по dt+vesy | Использовать dt/vesy без данных | 200 | пустой список и Success=true | must |
| INC-A-10 | Без токена | — | 401/403 | —                                           | must |
| INC-V-10 | Невалидные параметры | dt отсутствует/непарсится, vesy отсутствует/непарсится | 400 | body error (если DbResult) или текст ошибки | should |

---

## 2) GET /api/v1/incoming/wagons/by-date-time
### Операция
Получить список по `dt`, `vr` (время) и `vesy`.

### Исходы
| ID | Сценарий | Предусловия | HTTP | Ожидаемое тело (минимум) | Важность |
|---|---|---|---:|---|---|
| INC-RDT-01 | Есть данные по dt+vr+vesy | Создать запись через POST с теми же dt/vr/vesy | 200 | body not empty | must |
| INC-RDT-02 | Нет данных по dt+vr+vesy | dt/vr/vesy без данных | 200 | пустой список и Success=true  | must |
| INC-A-11 | Без токена | — | 401/403 | — | must |
| INC-V-11 | Невалидные параметры | dt/vr/vesy отсутствует или не парсится | 400 | error body | should |

---

## 3) GET /api/v1/incoming/wagons/by-date-time-nvag
### Операция
Получить данные конкретного взвешивания по `dt`, `vr`, `nvag`, `vesy`.

### Исходы
| ID | Сценарий | Предусловия | HTTP | Ожидаемое тело (минимум) | Важность |
|---|---|---|---:|---|---|
| INC-RDTV-01 | Запись найдена | POST создаёт запись с dt/vr/nvag/vesy | 200 | body not empty | must |
| INC-RDTV-02 | Запись не найдена | dt/vr/nvag/vesy без данных | 200 | пустой список и Success=true  | must |
| INC-A-12 | Без токена | — | 401/403 | — | must |
| INC-V-12 | Невалидные параметры | dt/vr/nvag/vesy отсутствуют/кривые | 400 | error body | should |

---

## 4) GET /api/v1/incoming/wagons/by-date-nvag
### Операция
Получить список взвешиваний вагона за дату по `dt`, `nvag` (+ возможно `vesy`, если реально участвует).

### Исходы
| ID | Сценарий | Предусловия | HTTP | Ожидаемое тело (минимум) | Важность |
|---|---|---|---:|---|---|
| INC-RDN-01 | Есть данные по dt+nvag | POST создать запись с dt+nvag | 200 | body not empty | must |
| INC-RDN-02 | Нет данных по dt+nvag | dt+nvag без данных | 200 | пустой список и Success=true | must |
| INC-A-13 | Без токена | — | 401/403 | — | must |
| INC-V-13 | Невалидные параметры | dt/nvag отсутствуют/кривые | 400 | error body | should |

---

## 5) GET /api/v1/incoming/wagons
### Операция
Получить «историю»/выборку взвешиваний (по скрину это отдельный GET; параметры уточним по Swagger: likely dtFrom/dtTo/nvag/vesy и т.п.)

### Исходы (универсальные)
| ID | Сценарий | Предусловия | HTTP | Ожидаемое тело (минимум) | Важность |
|---|---|---|---:|---|---|
| INC-RH-01 | Есть данные по параметрам | POST создать 1+ записей, затем запросить диапазоном | 200 | body not empty | must |
| INC-RH-02 | Нет данных по параметрам | параметры без данных | 200 | пустой список и Success=true | must |
| INC-A-14 | Без токена | — | 401/403 | — | must |
| INC-V-14 | Невалидные параметры | отсутствуют обязательные query params / формат неверный | 400 | error body | should |

---

## Примечание “по факту тела”
Для каждого GET на первом реальном тесте мы фиксируем, что именно возвращается при «нет данных»:
- пустая строка / пустой json / пустой список
- или DbResult с `Success=false`

После этого это становится контрактом v1, и тесты проверяют именно это.
